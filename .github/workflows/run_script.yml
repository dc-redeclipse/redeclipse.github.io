name: Execute Server Script Loop

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  run-python-loop:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install python-dotenv
          pip install -r requirements.txt

      - name: Run Execution Loop
        run: |
          # We embed your bash logic directly here
          SCRIPT_NAME="getservers.py"
          RUN_COUNT=5
          WAIT_TIME=30
          
          echo "Starting execution loop..."
          for (( i=1; i<=RUN_COUNT; i++ ))
          do
            echo "--- Run #$i of $RUN_COUNT ---"
            python3 "$SCRIPT_NAME"
            
            if [ $i -lt $RUN_COUNT ]; then
              echo "Waiting $WAIT_TIME seconds..."
              sleep $WAIT_TIME
            fi
          done
